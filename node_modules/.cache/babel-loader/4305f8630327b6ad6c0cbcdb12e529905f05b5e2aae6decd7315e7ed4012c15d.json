{"ast":null,"code":"import _construct from \"/Users/shan/SER375/node_modules/@babel/runtime/helpers/esm/construct.js\";\nimport _callSuper from \"/Users/shan/SER375/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"/Users/shan/SER375/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createForOfIteratorHelper from \"/Users/shan/SER375/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _typeof from \"/Users/shan/SER375/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport _classCallCheck from \"/Users/shan/SER375/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/shan/SER375/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array-buffer.slice.js\";\nimport \"core-js/modules/es.data-view.js\";\nimport \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.function.bind.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.typed-array.uint8-array.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.copy-within.js\";\nimport \"core-js/modules/es.typed-array.every.js\";\nimport \"core-js/modules/es.typed-array.fill.js\";\nimport \"core-js/modules/es.typed-array.filter.js\";\nimport \"core-js/modules/es.typed-array.find.js\";\nimport \"core-js/modules/es.typed-array.find-index.js\";\nimport \"core-js/modules/es.typed-array.find-last.js\";\nimport \"core-js/modules/es.typed-array.find-last-index.js\";\nimport \"core-js/modules/es.typed-array.for-each.js\";\nimport \"core-js/modules/es.typed-array.includes.js\";\nimport \"core-js/modules/es.typed-array.index-of.js\";\nimport \"core-js/modules/es.typed-array.iterator.js\";\nimport \"core-js/modules/es.typed-array.join.js\";\nimport \"core-js/modules/es.typed-array.last-index-of.js\";\nimport \"core-js/modules/es.typed-array.map.js\";\nimport \"core-js/modules/es.typed-array.reduce.js\";\nimport \"core-js/modules/es.typed-array.reduce-right.js\";\nimport \"core-js/modules/es.typed-array.reverse.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/es.typed-array.slice.js\";\nimport \"core-js/modules/es.typed-array.some.js\";\nimport \"core-js/modules/es.typed-array.sort.js\";\nimport \"core-js/modules/es.typed-array.subarray.js\";\nimport \"core-js/modules/es.typed-array.to-locale-string.js\";\nimport \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.to-string.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport \"core-js/modules/es.weak-map.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport firebase from '@firebase/app-compat';\nimport { FirestoreError, Bytes, _isBase64Available, enableIndexedDbPersistence as _enableIndexedDbPersistence, enableMultiTabIndexedDbPersistence as _enableMultiTabIndexedDbPersistence, clearIndexedDbPersistence as _clearIndexedDbPersistence, _DatabaseId, _logWarn, connectFirestoreEmulator, enableNetwork as _enableNetwork, disableNetwork as _disableNetwork, _validateIsNotUsedTogether, waitForPendingWrites as _waitForPendingWrites, onSnapshotsInSync as _onSnapshotsInSync, collection as _collection, doc as _doc, collectionGroup as _collectionGroup, runTransaction as _runTransaction, ensureFirestoreConfigured, WriteBatch as WriteBatch$1, executeWrite, loadBundle as _loadBundle, namedQuery as _namedQuery, DocumentSnapshot as DocumentSnapshot$1, DocumentReference as DocumentReference$1, _DocumentKey, refEqual, setDoc, updateDoc, deleteDoc, onSnapshot as _onSnapshot, getDocFromCache, getDocFromServer, getDoc, snapshotEqual, query, where as _where, orderBy as _orderBy, limit as _limit, limitToLast as _limitToLast, startAt as _startAt, startAfter as _startAfter, endBefore as _endBefore, endAt as _endAt, queryEqual, getDocsFromCache, getDocsFromServer, getDocs, QuerySnapshot as QuerySnapshot$1, addDoc, _cast, AbstractUserDataWriter, setLogLevel as setLogLevel$1, QueryDocumentSnapshot as QueryDocumentSnapshot$1, _debugAssert, FieldPath as FieldPath$1, _FieldPath, serverTimestamp as _serverTimestamp, deleteField, arrayUnion as _arrayUnion, arrayRemove as _arrayRemove, increment as _increment, GeoPoint, Timestamp, CACHE_SIZE_UNLIMITED } from '@firebase/firestore';\nimport { getModularInstance } from '@firebase/util';\nimport { Component } from '@firebase/component';\nvar name = \"@firebase/firestore-compat\";\nvar version = \"0.3.29\";\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction validateSetOptions(methodName, options) {\n  if (options === undefined) {\n    return {\n      merge: false\n    };\n  }\n  if (options.mergeFields !== undefined && options.merge !== undefined) {\n    throw new FirestoreError('invalid-argument', \"Invalid options passed to function \".concat(methodName, \"(): You cannot \") + 'specify both \"merge\" and \"mergeFields\".');\n  }\n  return options;\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/** Helper function to assert Uint8Array is available at runtime. */\nfunction assertUint8ArrayAvailable() {\n  if (typeof Uint8Array === 'undefined') {\n    throw new FirestoreError('unimplemented', 'Uint8Arrays are not available in this environment.');\n  }\n}\n/** Helper function to assert Base64 functions are available at runtime. */\nfunction assertBase64Available() {\n  if (!_isBase64Available()) {\n    throw new FirestoreError('unimplemented', 'Blobs are unavailable in Firestore in this environment.');\n  }\n}\n/** Immutable class holding a blob (binary data) */\nvar Blob = /*#__PURE__*/function () {\n  function Blob(_delegate) {\n    _classCallCheck(this, Blob);\n    this._delegate = _delegate;\n  }\n  return _createClass(Blob, [{\n    key: \"toBase64\",\n    value: function toBase64() {\n      assertBase64Available();\n      return this._delegate.toBase64();\n    }\n  }, {\n    key: \"toUint8Array\",\n    value: function toUint8Array() {\n      assertUint8ArrayAvailable();\n      return this._delegate.toUint8Array();\n    }\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      return this._delegate.isEqual(other._delegate);\n    }\n  }, {\n    key: \"toString\",\n    value: function toString() {\n      return 'Blob(base64: ' + this.toBase64() + ')';\n    }\n  }], [{\n    key: \"fromBase64String\",\n    value: function fromBase64String(base64) {\n      assertBase64Available();\n      return new Blob(Bytes.fromBase64String(base64));\n    }\n  }, {\n    key: \"fromUint8Array\",\n    value: function fromUint8Array(array) {\n      assertUint8ArrayAvailable();\n      return new Blob(Bytes.fromUint8Array(array));\n    }\n  }]);\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction isPartialObserver(obj) {\n  return implementsAnyMethods(obj, ['next', 'error', 'complete']);\n}\n/**\r\n * Returns true if obj is an object and contains at least one of the specified\r\n * methods.\r\n */\nfunction implementsAnyMethods(obj, methods) {\n  if (_typeof(obj) !== 'object' || obj === null) {\n    return false;\n  }\n  var object = obj;\n  var _iterator = _createForOfIteratorHelper(methods),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var method = _step.value;\n      if (method in object && typeof object[method] === 'function') {\n        return true;\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  return false;\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * The persistence provider included with the full Firestore SDK.\r\n */\nvar IndexedDbPersistenceProvider = /*#__PURE__*/function () {\n  function IndexedDbPersistenceProvider() {\n    _classCallCheck(this, IndexedDbPersistenceProvider);\n  }\n  return _createClass(IndexedDbPersistenceProvider, [{\n    key: \"enableIndexedDbPersistence\",\n    value: function enableIndexedDbPersistence(firestore, forceOwnership) {\n      return _enableIndexedDbPersistence(firestore._delegate, {\n        forceOwnership: forceOwnership\n      });\n    }\n  }, {\n    key: \"enableMultiTabIndexedDbPersistence\",\n    value: function enableMultiTabIndexedDbPersistence(firestore) {\n      return _enableMultiTabIndexedDbPersistence(firestore._delegate);\n    }\n  }, {\n    key: \"clearIndexedDbPersistence\",\n    value: function clearIndexedDbPersistence(firestore) {\n      return _clearIndexedDbPersistence(firestore._delegate);\n    }\n  }]);\n}();\n/**\r\n * Compat class for Firestore. Exposes Firestore Legacy API, but delegates\r\n * to the functional API of firestore-exp.\r\n */\nvar Firestore = /*#__PURE__*/function () {\n  function Firestore(databaseIdOrApp, _delegate, _persistenceProvider) {\n    var _this = this;\n    _classCallCheck(this, Firestore);\n    this._delegate = _delegate;\n    this._persistenceProvider = _persistenceProvider;\n    this.INTERNAL = {\n      \"delete\": function _delete() {\n        return _this.terminate();\n      }\n    };\n    if (!(databaseIdOrApp instanceof _DatabaseId)) {\n      this._appCompat = databaseIdOrApp;\n    }\n  }\n  return _createClass(Firestore, [{\n    key: \"_databaseId\",\n    get: function get() {\n      return this._delegate._databaseId;\n    }\n  }, {\n    key: \"settings\",\n    value: function settings(settingsLiteral) {\n      var currentSettings = this._delegate._getSettings();\n      if (!settingsLiteral.merge && currentSettings.host !== settingsLiteral.host) {\n        _logWarn('You are overriding the original host. If you did not intend ' + 'to override your settings, use {merge: true}.');\n      }\n      if (settingsLiteral.merge) {\n        settingsLiteral = Object.assign(Object.assign({}, currentSettings), settingsLiteral);\n        // Remove the property from the settings once the merge is completed\n        delete settingsLiteral.merge;\n      }\n      this._delegate._setSettings(settingsLiteral);\n    }\n  }, {\n    key: \"useEmulator\",\n    value: function useEmulator(host, port) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      connectFirestoreEmulator(this._delegate, host, port, options);\n    }\n  }, {\n    key: \"enableNetwork\",\n    value: function enableNetwork() {\n      return _enableNetwork(this._delegate);\n    }\n  }, {\n    key: \"disableNetwork\",\n    value: function disableNetwork() {\n      return _disableNetwork(this._delegate);\n    }\n  }, {\n    key: \"enablePersistence\",\n    value: function enablePersistence(settings) {\n      var synchronizeTabs = false;\n      var experimentalForceOwningTab = false;\n      if (settings) {\n        synchronizeTabs = !!settings.synchronizeTabs;\n        experimentalForceOwningTab = !!settings.experimentalForceOwningTab;\n        _validateIsNotUsedTogether('synchronizeTabs', synchronizeTabs, 'experimentalForceOwningTab', experimentalForceOwningTab);\n      }\n      return synchronizeTabs ? this._persistenceProvider.enableMultiTabIndexedDbPersistence(this) : this._persistenceProvider.enableIndexedDbPersistence(this, experimentalForceOwningTab);\n    }\n  }, {\n    key: \"clearPersistence\",\n    value: function clearPersistence() {\n      return this._persistenceProvider.clearIndexedDbPersistence(this);\n    }\n  }, {\n    key: \"terminate\",\n    value: function terminate() {\n      if (this._appCompat) {\n        this._appCompat._removeServiceInstance('firestore-compat');\n        this._appCompat._removeServiceInstance('firestore');\n      }\n      return this._delegate._delete();\n    }\n  }, {\n    key: \"waitForPendingWrites\",\n    value: function waitForPendingWrites() {\n      return _waitForPendingWrites(this._delegate);\n    }\n  }, {\n    key: \"onSnapshotsInSync\",\n    value: function onSnapshotsInSync(arg) {\n      return _onSnapshotsInSync(this._delegate, arg);\n    }\n  }, {\n    key: \"app\",\n    get: function get() {\n      if (!this._appCompat) {\n        throw new FirestoreError('failed-precondition', \"Firestore was not initialized using the Firebase SDK. 'app' is \" + 'not available');\n      }\n      return this._appCompat;\n    }\n  }, {\n    key: \"collection\",\n    value: function collection(pathString) {\n      try {\n        return new CollectionReference(this, _collection(this._delegate, pathString));\n      } catch (e) {\n        throw replaceFunctionName(e, 'collection()', 'Firestore.collection()');\n      }\n    }\n  }, {\n    key: \"doc\",\n    value: function doc(pathString) {\n      try {\n        return new DocumentReference(this, _doc(this._delegate, pathString));\n      } catch (e) {\n        throw replaceFunctionName(e, 'doc()', 'Firestore.doc()');\n      }\n    }\n  }, {\n    key: \"collectionGroup\",\n    value: function collectionGroup(collectionId) {\n      try {\n        return new Query(this, _collectionGroup(this._delegate, collectionId));\n      } catch (e) {\n        throw replaceFunctionName(e, 'collectionGroup()', 'Firestore.collectionGroup()');\n      }\n    }\n  }, {\n    key: \"runTransaction\",\n    value: function runTransaction(updateFunction) {\n      var _this2 = this;\n      return _runTransaction(this._delegate, function (transaction) {\n        return updateFunction(new Transaction(_this2, transaction));\n      });\n    }\n  }, {\n    key: \"batch\",\n    value: function batch() {\n      var _this3 = this;\n      ensureFirestoreConfigured(this._delegate);\n      return new WriteBatch(new WriteBatch$1(this._delegate, function (mutations) {\n        return executeWrite(_this3._delegate, mutations);\n      }));\n    }\n  }, {\n    key: \"loadBundle\",\n    value: function loadBundle(bundleData) {\n      return _loadBundle(this._delegate, bundleData);\n    }\n  }, {\n    key: \"namedQuery\",\n    value: function namedQuery(name) {\n      var _this4 = this;\n      return _namedQuery(this._delegate, name).then(function (expQuery) {\n        if (!expQuery) {\n          return null;\n        }\n        return new Query(_this4,\n        // We can pass `expQuery` here directly since named queries don't have a UserDataConverter.\n        // Otherwise, we would have to create a new ExpQuery and pass the old UserDataConverter.\n        expQuery);\n      });\n    }\n  }]);\n}();\nvar UserDataWriter = /*#__PURE__*/function (_AbstractUserDataWrit) {\n  function UserDataWriter(firestore) {\n    var _this5;\n    _classCallCheck(this, UserDataWriter);\n    _this5 = _callSuper(this, UserDataWriter);\n    _this5.firestore = firestore;\n    return _this5;\n  }\n  _inherits(UserDataWriter, _AbstractUserDataWrit);\n  return _createClass(UserDataWriter, [{\n    key: \"convertBytes\",\n    value: function convertBytes(bytes) {\n      return new Blob(new Bytes(bytes));\n    }\n  }, {\n    key: \"convertReference\",\n    value: function convertReference(name) {\n      var key = this.convertDocumentKey(name, this.firestore._databaseId);\n      return DocumentReference.forKey(key, this.firestore, /* converter= */null);\n    }\n  }]);\n}(AbstractUserDataWriter);\nfunction setLogLevel(level) {\n  setLogLevel$1(level);\n}\n/**\r\n * A reference to a transaction.\r\n */\nvar Transaction = /*#__PURE__*/function () {\n  function Transaction(_firestore, _delegate) {\n    _classCallCheck(this, Transaction);\n    this._firestore = _firestore;\n    this._delegate = _delegate;\n    this._userDataWriter = new UserDataWriter(_firestore);\n  }\n  return _createClass(Transaction, [{\n    key: \"get\",\n    value: function get(documentRef) {\n      var _this6 = this;\n      var ref = castReference(documentRef);\n      return this._delegate.get(ref).then(function (result) {\n        return new DocumentSnapshot(_this6._firestore, new DocumentSnapshot$1(_this6._firestore._delegate, _this6._userDataWriter, result._key, result._document, result.metadata, ref.converter));\n      });\n    }\n  }, {\n    key: \"set\",\n    value: function set(documentRef, data, options) {\n      var ref = castReference(documentRef);\n      if (options) {\n        validateSetOptions('Transaction.set', options);\n        this._delegate.set(ref, data, options);\n      } else {\n        this._delegate.set(ref, data);\n      }\n      return this;\n    }\n  }, {\n    key: \"update\",\n    value: function update(documentRef, dataOrField, value) {\n      for (var _len = arguments.length, moreFieldsAndValues = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        moreFieldsAndValues[_key - 3] = arguments[_key];\n      }\n      var ref = castReference(documentRef);\n      if (arguments.length === 2) {\n        this._delegate.update(ref, dataOrField);\n      } else {\n        var _this$_delegate;\n        (_this$_delegate = this._delegate).update.apply(_this$_delegate, [ref, dataOrField, value].concat(moreFieldsAndValues));\n      }\n      return this;\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(documentRef) {\n      var ref = castReference(documentRef);\n      this._delegate[\"delete\"](ref);\n      return this;\n    }\n  }]);\n}();\nvar WriteBatch = /*#__PURE__*/function () {\n  function WriteBatch(_delegate) {\n    _classCallCheck(this, WriteBatch);\n    this._delegate = _delegate;\n  }\n  return _createClass(WriteBatch, [{\n    key: \"set\",\n    value: function set(documentRef, data, options) {\n      var ref = castReference(documentRef);\n      if (options) {\n        validateSetOptions('WriteBatch.set', options);\n        this._delegate.set(ref, data, options);\n      } else {\n        this._delegate.set(ref, data);\n      }\n      return this;\n    }\n  }, {\n    key: \"update\",\n    value: function update(documentRef, dataOrField, value) {\n      for (var _len2 = arguments.length, moreFieldsAndValues = new Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {\n        moreFieldsAndValues[_key2 - 3] = arguments[_key2];\n      }\n      var ref = castReference(documentRef);\n      if (arguments.length === 2) {\n        this._delegate.update(ref, dataOrField);\n      } else {\n        var _this$_delegate2;\n        (_this$_delegate2 = this._delegate).update.apply(_this$_delegate2, [ref, dataOrField, value].concat(moreFieldsAndValues));\n      }\n      return this;\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete(documentRef) {\n      var ref = castReference(documentRef);\n      this._delegate[\"delete\"](ref);\n      return this;\n    }\n  }, {\n    key: \"commit\",\n    value: function commit() {\n      return this._delegate.commit();\n    }\n  }]);\n}();\n/**\r\n * Wraps a `PublicFirestoreDataConverter` translating the types from the\r\n * experimental SDK into corresponding types from the Classic SDK before passing\r\n * them to the wrapped converter.\r\n */\nvar FirestoreDataConverter = /*#__PURE__*/function () {\n  function FirestoreDataConverter(_firestore, _userDataWriter, _delegate) {\n    _classCallCheck(this, FirestoreDataConverter);\n    this._firestore = _firestore;\n    this._userDataWriter = _userDataWriter;\n    this._delegate = _delegate;\n  }\n  return _createClass(FirestoreDataConverter, [{\n    key: \"fromFirestore\",\n    value: function fromFirestore(snapshot, options) {\n      var expSnapshot = new QueryDocumentSnapshot$1(this._firestore._delegate, this._userDataWriter, snapshot._key, snapshot._document, snapshot.metadata, /* converter= */null);\n      return this._delegate.fromFirestore(new QueryDocumentSnapshot(this._firestore, expSnapshot), options !== null && options !== void 0 ? options : {});\n    }\n  }, {\n    key: \"toFirestore\",\n    value: function toFirestore(modelObject, options) {\n      if (!options) {\n        return this._delegate.toFirestore(modelObject);\n      } else {\n        return this._delegate.toFirestore(modelObject, options);\n      }\n    }\n    // Use the same instance of `FirestoreDataConverter` for the given instances\n    // of `Firestore` and `PublicFirestoreDataConverter` so that isEqual() will\n    // compare equal for two objects created with the same converter instance.\n  }], [{\n    key: \"getInstance\",\n    value: function getInstance(firestore, converter) {\n      var converterMapByFirestore = FirestoreDataConverter.INSTANCES;\n      var untypedConverterByConverter = converterMapByFirestore.get(firestore);\n      if (!untypedConverterByConverter) {\n        untypedConverterByConverter = new WeakMap();\n        converterMapByFirestore.set(firestore, untypedConverterByConverter);\n      }\n      var instance = untypedConverterByConverter.get(converter);\n      if (!instance) {\n        instance = new FirestoreDataConverter(firestore, new UserDataWriter(firestore), converter);\n        untypedConverterByConverter.set(converter, instance);\n      }\n      return instance;\n    }\n  }]);\n}();\nFirestoreDataConverter.INSTANCES = new WeakMap();\n/**\r\n * A reference to a particular document in a collection in the database.\r\n */\nvar DocumentReference = /*#__PURE__*/function () {\n  function DocumentReference(firestore, _delegate) {\n    _classCallCheck(this, DocumentReference);\n    this.firestore = firestore;\n    this._delegate = _delegate;\n    this._userDataWriter = new UserDataWriter(firestore);\n  }\n  return _createClass(DocumentReference, [{\n    key: \"id\",\n    get: function get() {\n      return this._delegate.id;\n    }\n  }, {\n    key: \"parent\",\n    get: function get() {\n      return new CollectionReference(this.firestore, this._delegate.parent);\n    }\n  }, {\n    key: \"path\",\n    get: function get() {\n      return this._delegate.path;\n    }\n  }, {\n    key: \"collection\",\n    value: function collection(pathString) {\n      try {\n        return new CollectionReference(this.firestore, _collection(this._delegate, pathString));\n      } catch (e) {\n        throw replaceFunctionName(e, 'collection()', 'DocumentReference.collection()');\n      }\n    }\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      other = getModularInstance(other);\n      if (!(other instanceof DocumentReference$1)) {\n        return false;\n      }\n      return refEqual(this._delegate, other);\n    }\n  }, {\n    key: \"set\",\n    value: function set(value, options) {\n      options = validateSetOptions('DocumentReference.set', options);\n      try {\n        if (options) {\n          return setDoc(this._delegate, value, options);\n        } else {\n          return setDoc(this._delegate, value);\n        }\n      } catch (e) {\n        throw replaceFunctionName(e, 'setDoc()', 'DocumentReference.set()');\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update(fieldOrUpdateData, value) {\n      for (var _len3 = arguments.length, moreFieldsAndValues = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n        moreFieldsAndValues[_key3 - 2] = arguments[_key3];\n      }\n      try {\n        if (arguments.length === 1) {\n          return updateDoc(this._delegate, fieldOrUpdateData);\n        } else {\n          return updateDoc.apply(void 0, [this._delegate, fieldOrUpdateData, value].concat(moreFieldsAndValues));\n        }\n      } catch (e) {\n        throw replaceFunctionName(e, 'updateDoc()', 'DocumentReference.update()');\n      }\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete() {\n      return deleteDoc(this._delegate);\n    }\n  }, {\n    key: \"onSnapshot\",\n    value: function onSnapshot() {\n      var _this7 = this;\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n      var options = extractSnapshotOptions(args);\n      var observer = wrapObserver(args, function (result) {\n        return new DocumentSnapshot(_this7.firestore, new DocumentSnapshot$1(_this7.firestore._delegate, _this7._userDataWriter, result._key, result._document, result.metadata, _this7._delegate.converter));\n      });\n      return _onSnapshot(this._delegate, options, observer);\n    }\n  }, {\n    key: \"get\",\n    value: function get(options) {\n      var _this8 = this;\n      var snap;\n      if ((options === null || options === void 0 ? void 0 : options.source) === 'cache') {\n        snap = getDocFromCache(this._delegate);\n      } else if ((options === null || options === void 0 ? void 0 : options.source) === 'server') {\n        snap = getDocFromServer(this._delegate);\n      } else {\n        snap = getDoc(this._delegate);\n      }\n      return snap.then(function (result) {\n        return new DocumentSnapshot(_this8.firestore, new DocumentSnapshot$1(_this8.firestore._delegate, _this8._userDataWriter, result._key, result._document, result.metadata, _this8._delegate.converter));\n      });\n    }\n  }, {\n    key: \"withConverter\",\n    value: function withConverter(converter) {\n      return new DocumentReference(this.firestore, converter ? this._delegate.withConverter(FirestoreDataConverter.getInstance(this.firestore, converter)) : this._delegate.withConverter(null));\n    }\n  }], [{\n    key: \"forPath\",\n    value: function forPath(path, firestore, converter) {\n      if (path.length % 2 !== 0) {\n        throw new FirestoreError('invalid-argument', 'Invalid document reference. Document ' + 'references must have an even number of segments, but ' + \"\".concat(path.canonicalString(), \" has \").concat(path.length));\n      }\n      return new DocumentReference(firestore, new DocumentReference$1(firestore._delegate, converter, new _DocumentKey(path)));\n    }\n  }, {\n    key: \"forKey\",\n    value: function forKey(key, firestore, converter) {\n      return new DocumentReference(firestore, new DocumentReference$1(firestore._delegate, converter, key));\n    }\n  }]);\n}();\n/**\r\n * Replaces the function name in an error thrown by the firestore-exp API\r\n * with the function names used in the classic API.\r\n */\nfunction replaceFunctionName(e, original, updated) {\n  e.message = e.message.replace(original, updated);\n  return e;\n}\n/**\r\n * Iterates the list of arguments from an `onSnapshot` call and returns the\r\n * first argument that may be an `SnapshotListenOptions` object. Returns an\r\n * empty object if none is found.\r\n */\nfunction extractSnapshotOptions(args) {\n  var _iterator2 = _createForOfIteratorHelper(args),\n    _step2;\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var arg = _step2.value;\n      if (_typeof(arg) === 'object' && !isPartialObserver(arg)) {\n        return arg;\n      }\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n  return {};\n}\n/**\r\n * Creates an observer that can be passed to the firestore-exp SDK. The\r\n * observer converts all observed values into the format expected by the classic\r\n * SDK.\r\n *\r\n * @param args - The list of arguments from an `onSnapshot` call.\r\n * @param wrapper - The function that converts the firestore-exp type into the\r\n * type used by this shim.\r\n */\nfunction wrapObserver(args, wrapper) {\n  var _a, _b;\n  var userObserver;\n  if (isPartialObserver(args[0])) {\n    userObserver = args[0];\n  } else if (isPartialObserver(args[1])) {\n    userObserver = args[1];\n  } else if (typeof args[0] === 'function') {\n    userObserver = {\n      next: args[0],\n      error: args[1],\n      complete: args[2]\n    };\n  } else {\n    userObserver = {\n      next: args[1],\n      error: args[2],\n      complete: args[3]\n    };\n  }\n  return {\n    next: function next(val) {\n      if (userObserver.next) {\n        userObserver.next(wrapper(val));\n      }\n    },\n    error: (_a = userObserver.error) === null || _a === void 0 ? void 0 : _a.bind(userObserver),\n    complete: (_b = userObserver.complete) === null || _b === void 0 ? void 0 : _b.bind(userObserver)\n  };\n}\nvar DocumentSnapshot = /*#__PURE__*/function () {\n  function DocumentSnapshot(_firestore, _delegate) {\n    _classCallCheck(this, DocumentSnapshot);\n    this._firestore = _firestore;\n    this._delegate = _delegate;\n  }\n  return _createClass(DocumentSnapshot, [{\n    key: \"ref\",\n    get: function get() {\n      return new DocumentReference(this._firestore, this._delegate.ref);\n    }\n  }, {\n    key: \"id\",\n    get: function get() {\n      return this._delegate.id;\n    }\n  }, {\n    key: \"metadata\",\n    get: function get() {\n      return this._delegate.metadata;\n    }\n  }, {\n    key: \"exists\",\n    get: function get() {\n      return this._delegate.exists();\n    }\n  }, {\n    key: \"data\",\n    value: function data(options) {\n      return this._delegate.data(options);\n    }\n  }, {\n    key: \"get\",\n    value: function get(fieldPath, options\n    // We are using `any` here to avoid an explicit cast by our users.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ) {\n      return this._delegate.get(fieldPath, options);\n    }\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      return snapshotEqual(this._delegate, other._delegate);\n    }\n  }]);\n}();\nvar QueryDocumentSnapshot = /*#__PURE__*/function (_DocumentSnapshot) {\n  function QueryDocumentSnapshot() {\n    _classCallCheck(this, QueryDocumentSnapshot);\n    return _callSuper(this, QueryDocumentSnapshot, arguments);\n  }\n  _inherits(QueryDocumentSnapshot, _DocumentSnapshot);\n  return _createClass(QueryDocumentSnapshot, [{\n    key: \"data\",\n    value: function data(options) {\n      var data = this._delegate.data(options);\n      if (this._delegate._converter) {\n        // Undefined is a possible valid value from converter.\n        return data;\n      } else {\n        _debugAssert(data !== undefined, 'Document in a QueryDocumentSnapshot should exist');\n        return data;\n      }\n    }\n  }]);\n}(DocumentSnapshot);\nvar Query = /*#__PURE__*/function () {\n  function Query(firestore, _delegate) {\n    _classCallCheck(this, Query);\n    this.firestore = firestore;\n    this._delegate = _delegate;\n    this._userDataWriter = new UserDataWriter(firestore);\n  }\n  return _createClass(Query, [{\n    key: \"where\",\n    value: function where(fieldPath, opStr, value) {\n      try {\n        // The \"as string\" cast is a little bit of a hack. `where` accepts the\n        // FieldPath Compat type as input, but is not typed as such in order to\n        // not expose this via our public typings file.\n        return new Query(this.firestore, query(this._delegate, _where(fieldPath, opStr, value)));\n      } catch (e) {\n        throw replaceFunctionName(e, /(orderBy|where)\\(\\)/, 'Query.$1()');\n      }\n    }\n  }, {\n    key: \"orderBy\",\n    value: function orderBy(fieldPath, directionStr) {\n      try {\n        // The \"as string\" cast is a little bit of a hack. `orderBy` accepts the\n        // FieldPath Compat type as input, but is not typed as such in order to\n        // not expose this via our public typings file.\n        return new Query(this.firestore, query(this._delegate, _orderBy(fieldPath, directionStr)));\n      } catch (e) {\n        throw replaceFunctionName(e, /(orderBy|where)\\(\\)/, 'Query.$1()');\n      }\n    }\n  }, {\n    key: \"limit\",\n    value: function limit(n) {\n      try {\n        return new Query(this.firestore, query(this._delegate, _limit(n)));\n      } catch (e) {\n        throw replaceFunctionName(e, 'limit()', 'Query.limit()');\n      }\n    }\n  }, {\n    key: \"limitToLast\",\n    value: function limitToLast(n) {\n      try {\n        return new Query(this.firestore, query(this._delegate, _limitToLast(n)));\n      } catch (e) {\n        throw replaceFunctionName(e, 'limitToLast()', 'Query.limitToLast()');\n      }\n    }\n  }, {\n    key: \"startAt\",\n    value: function startAt() {\n      try {\n        return new Query(this.firestore, query(this._delegate, _startAt.apply(void 0, arguments)));\n      } catch (e) {\n        throw replaceFunctionName(e, 'startAt()', 'Query.startAt()');\n      }\n    }\n  }, {\n    key: \"startAfter\",\n    value: function startAfter() {\n      try {\n        return new Query(this.firestore, query(this._delegate, _startAfter.apply(void 0, arguments)));\n      } catch (e) {\n        throw replaceFunctionName(e, 'startAfter()', 'Query.startAfter()');\n      }\n    }\n  }, {\n    key: \"endBefore\",\n    value: function endBefore() {\n      try {\n        return new Query(this.firestore, query(this._delegate, _endBefore.apply(void 0, arguments)));\n      } catch (e) {\n        throw replaceFunctionName(e, 'endBefore()', 'Query.endBefore()');\n      }\n    }\n  }, {\n    key: \"endAt\",\n    value: function endAt() {\n      try {\n        return new Query(this.firestore, query(this._delegate, _endAt.apply(void 0, arguments)));\n      } catch (e) {\n        throw replaceFunctionName(e, 'endAt()', 'Query.endAt()');\n      }\n    }\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      return queryEqual(this._delegate, other._delegate);\n    }\n  }, {\n    key: \"get\",\n    value: function get(options) {\n      var _this9 = this;\n      var query;\n      if ((options === null || options === void 0 ? void 0 : options.source) === 'cache') {\n        query = getDocsFromCache(this._delegate);\n      } else if ((options === null || options === void 0 ? void 0 : options.source) === 'server') {\n        query = getDocsFromServer(this._delegate);\n      } else {\n        query = getDocs(this._delegate);\n      }\n      return query.then(function (result) {\n        return new QuerySnapshot(_this9.firestore, new QuerySnapshot$1(_this9.firestore._delegate, _this9._userDataWriter, _this9._delegate, result._snapshot));\n      });\n    }\n  }, {\n    key: \"onSnapshot\",\n    value: function onSnapshot() {\n      var _this10 = this;\n      for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n        args[_key5] = arguments[_key5];\n      }\n      var options = extractSnapshotOptions(args);\n      var observer = wrapObserver(args, function (snap) {\n        return new QuerySnapshot(_this10.firestore, new QuerySnapshot$1(_this10.firestore._delegate, _this10._userDataWriter, _this10._delegate, snap._snapshot));\n      });\n      return _onSnapshot(this._delegate, options, observer);\n    }\n  }, {\n    key: \"withConverter\",\n    value: function withConverter(converter) {\n      return new Query(this.firestore, converter ? this._delegate.withConverter(FirestoreDataConverter.getInstance(this.firestore, converter)) : this._delegate.withConverter(null));\n    }\n  }]);\n}();\nvar DocumentChange = /*#__PURE__*/function () {\n  function DocumentChange(_firestore, _delegate) {\n    _classCallCheck(this, DocumentChange);\n    this._firestore = _firestore;\n    this._delegate = _delegate;\n  }\n  return _createClass(DocumentChange, [{\n    key: \"type\",\n    get: function get() {\n      return this._delegate.type;\n    }\n  }, {\n    key: \"doc\",\n    get: function get() {\n      return new QueryDocumentSnapshot(this._firestore, this._delegate.doc);\n    }\n  }, {\n    key: \"oldIndex\",\n    get: function get() {\n      return this._delegate.oldIndex;\n    }\n  }, {\n    key: \"newIndex\",\n    get: function get() {\n      return this._delegate.newIndex;\n    }\n  }]);\n}();\nvar QuerySnapshot = /*#__PURE__*/function () {\n  function QuerySnapshot(_firestore, _delegate) {\n    _classCallCheck(this, QuerySnapshot);\n    this._firestore = _firestore;\n    this._delegate = _delegate;\n  }\n  return _createClass(QuerySnapshot, [{\n    key: \"query\",\n    get: function get() {\n      return new Query(this._firestore, this._delegate.query);\n    }\n  }, {\n    key: \"metadata\",\n    get: function get() {\n      return this._delegate.metadata;\n    }\n  }, {\n    key: \"size\",\n    get: function get() {\n      return this._delegate.size;\n    }\n  }, {\n    key: \"empty\",\n    get: function get() {\n      return this._delegate.empty;\n    }\n  }, {\n    key: \"docs\",\n    get: function get() {\n      var _this11 = this;\n      return this._delegate.docs.map(function (doc) {\n        return new QueryDocumentSnapshot(_this11._firestore, doc);\n      });\n    }\n  }, {\n    key: \"docChanges\",\n    value: function docChanges(options) {\n      var _this12 = this;\n      return this._delegate.docChanges(options).map(function (docChange) {\n        return new DocumentChange(_this12._firestore, docChange);\n      });\n    }\n  }, {\n    key: \"forEach\",\n    value: function forEach(callback, thisArg) {\n      var _this13 = this;\n      this._delegate.forEach(function (snapshot) {\n        callback.call(thisArg, new QueryDocumentSnapshot(_this13._firestore, snapshot));\n      });\n    }\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      return snapshotEqual(this._delegate, other._delegate);\n    }\n  }]);\n}();\nvar CollectionReference = /*#__PURE__*/function (_Query) {\n  function CollectionReference(firestore, _delegate) {\n    var _this14;\n    _classCallCheck(this, CollectionReference);\n    _this14 = _callSuper(this, CollectionReference, [firestore, _delegate]);\n    _this14.firestore = firestore;\n    _this14._delegate = _delegate;\n    return _this14;\n  }\n  _inherits(CollectionReference, _Query);\n  return _createClass(CollectionReference, [{\n    key: \"id\",\n    get: function get() {\n      return this._delegate.id;\n    }\n  }, {\n    key: \"path\",\n    get: function get() {\n      return this._delegate.path;\n    }\n  }, {\n    key: \"parent\",\n    get: function get() {\n      var docRef = this._delegate.parent;\n      return docRef ? new DocumentReference(this.firestore, docRef) : null;\n    }\n  }, {\n    key: \"doc\",\n    value: function doc(documentPath) {\n      try {\n        if (documentPath === undefined) {\n          // Call `doc` without `documentPath` if `documentPath` is `undefined`\n          // as `doc` validates the number of arguments to prevent users from\n          // accidentally passing `undefined`.\n          return new DocumentReference(this.firestore, _doc(this._delegate));\n        } else {\n          return new DocumentReference(this.firestore, _doc(this._delegate, documentPath));\n        }\n      } catch (e) {\n        throw replaceFunctionName(e, 'doc()', 'CollectionReference.doc()');\n      }\n    }\n  }, {\n    key: \"add\",\n    value: function add(data) {\n      var _this15 = this;\n      return addDoc(this._delegate, data).then(function (docRef) {\n        return new DocumentReference(_this15.firestore, docRef);\n      });\n    }\n  }, {\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      return refEqual(this._delegate, other._delegate);\n    }\n  }, {\n    key: \"withConverter\",\n    value: function withConverter(converter) {\n      return new CollectionReference(this.firestore, converter ? this._delegate.withConverter(FirestoreDataConverter.getInstance(this.firestore, converter)) : this._delegate.withConverter(null));\n    }\n  }]);\n}(Query);\nfunction castReference(documentRef) {\n  return _cast(documentRef, DocumentReference$1);\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// The objects that are a part of this API are exposed to third-parties as\n// compiled javascript so we want to flag our private members with a leading\n// underscore to discourage their use.\n/**\r\n * A `FieldPath` refers to a field in a document. The path may consist of a\r\n * single field name (referring to a top-level field in the document), or a list\r\n * of field names (referring to a nested field in the document).\r\n */\nvar FieldPath = /*#__PURE__*/function () {\n  /**\r\n   * Creates a FieldPath from the provided field names. If more than one field\r\n   * name is provided, the path will point to a nested field in a document.\r\n   *\r\n   * @param fieldNames - A list of field names.\r\n   */\n  function FieldPath() {\n    _classCallCheck(this, FieldPath);\n    for (var _len6 = arguments.length, fieldNames = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      fieldNames[_key6] = arguments[_key6];\n    }\n    this._delegate = _construct(FieldPath$1, fieldNames);\n  }\n  return _createClass(FieldPath, [{\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      other = getModularInstance(other);\n      if (!(other instanceof FieldPath$1)) {\n        return false;\n      }\n      return this._delegate._internalPath.isEqual(other._internalPath);\n    }\n  }], [{\n    key: \"documentId\",\n    value: function documentId() {\n      /**\r\n       * Internal Note: The backend doesn't technically support querying by\r\n       * document ID. Instead it queries by the entire document name (full path\r\n       * included), but in the cases we currently support documentId(), the net\r\n       * effect is the same.\r\n       */\n      return new FieldPath(_FieldPath.keyField().canonicalString());\n    }\n  }]);\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar FieldValue = /*#__PURE__*/function () {\n  function FieldValue(_delegate) {\n    _classCallCheck(this, FieldValue);\n    this._delegate = _delegate;\n  }\n  return _createClass(FieldValue, [{\n    key: \"isEqual\",\n    value: function isEqual(other) {\n      return this._delegate.isEqual(other._delegate);\n    }\n  }], [{\n    key: \"serverTimestamp\",\n    value: function serverTimestamp() {\n      var delegate = _serverTimestamp();\n      delegate._methodName = 'FieldValue.serverTimestamp';\n      return new FieldValue(delegate);\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete() {\n      var delegate = deleteField();\n      delegate._methodName = 'FieldValue.delete';\n      return new FieldValue(delegate);\n    }\n  }, {\n    key: \"arrayUnion\",\n    value: function arrayUnion() {\n      var delegate = _arrayUnion.apply(void 0, arguments);\n      delegate._methodName = 'FieldValue.arrayUnion';\n      return new FieldValue(delegate);\n    }\n  }, {\n    key: \"arrayRemove\",\n    value: function arrayRemove() {\n      var delegate = _arrayRemove.apply(void 0, arguments);\n      delegate._methodName = 'FieldValue.arrayRemove';\n      return new FieldValue(delegate);\n    }\n  }, {\n    key: \"increment\",\n    value: function increment(n) {\n      var delegate = _increment(n);\n      delegate._methodName = 'FieldValue.increment';\n      return new FieldValue(delegate);\n    }\n  }]);\n}();\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar firestoreNamespace = {\n  Firestore: Firestore,\n  GeoPoint: GeoPoint,\n  Timestamp: Timestamp,\n  Blob: Blob,\n  Transaction: Transaction,\n  WriteBatch: WriteBatch,\n  DocumentReference: DocumentReference,\n  DocumentSnapshot: DocumentSnapshot,\n  Query: Query,\n  QueryDocumentSnapshot: QueryDocumentSnapshot,\n  QuerySnapshot: QuerySnapshot,\n  CollectionReference: CollectionReference,\n  FieldPath: FieldPath,\n  FieldValue: FieldValue,\n  setLogLevel: setLogLevel,\n  CACHE_SIZE_UNLIMITED: CACHE_SIZE_UNLIMITED\n};\n/**\r\n * Configures Firestore as part of the Firebase SDK by calling registerComponent.\r\n *\r\n * @param firebase - The FirebaseNamespace to register Firestore with\r\n * @param firestoreFactory - A factory function that returns a new Firestore\r\n *    instance.\r\n */\nfunction configureForFirebase(firebase, firestoreFactory) {\n  firebase.INTERNAL.registerComponent(new Component('firestore-compat', function (container) {\n    var app = container.getProvider('app-compat').getImmediate();\n    var firestoreExp = container.getProvider('firestore').getImmediate();\n    return firestoreFactory(app, firestoreExp);\n  }, 'PUBLIC').setServiceProps(Object.assign({}, firestoreNamespace)));\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Registers the main Firestore build with the components framework.\r\n * Persistence can be enabled via `firebase.firestore().enablePersistence()`.\r\n */\nfunction registerFirestore(instance) {\n  configureForFirebase(instance, function (app, firestoreExp) {\n    return new Firestore(app, firestoreExp, new IndexedDbPersistenceProvider());\n  });\n  instance.registerVersion(name, version);\n}\nregisterFirestore(firebase);\nexport { registerFirestore };","map":{"version":3,"names":["validateSetOptions","methodName","options","undefined","merge","mergeFields","FirestoreError","concat","assertUint8ArrayAvailable","Uint8Array","assertBase64Available","_isBase64Available","Blob","_delegate","_classCallCheck","_createClass","key","value","toBase64","toUint8Array","isEqual","other","toString","fromBase64String","base64","Bytes","fromUint8Array","array","isPartialObserver","obj","implementsAnyMethods","methods","_typeof","object","_iterator","_createForOfIteratorHelper","_step","s","n","done","method","err","e","f","IndexedDbPersistenceProvider","enableIndexedDbPersistence","firestore","forceOwnership","enableMultiTabIndexedDbPersistence","clearIndexedDbPersistence","Firestore","databaseIdOrApp","_persistenceProvider","_this","INTERNAL","_delete","terminate","_DatabaseId","_appCompat","get","_databaseId","settings","settingsLiteral","currentSettings","_getSettings","host","_logWarn","Object","assign","_setSettings","useEmulator","port","arguments","length","connectFirestoreEmulator","enableNetwork","disableNetwork","enablePersistence","synchronizeTabs","experimentalForceOwningTab","_validateIsNotUsedTogether","clearPersistence","_removeServiceInstance","waitForPendingWrites","onSnapshotsInSync","arg","collection","pathString","CollectionReference","replaceFunctionName","doc","DocumentReference","collectionGroup","collectionId","Query","runTransaction","updateFunction","_this2","transaction","Transaction","batch","_this3","ensureFirestoreConfigured","WriteBatch","WriteBatch$1","mutations","executeWrite","loadBundle","bundleData","namedQuery","name","_this4","then","expQuery","UserDataWriter","_AbstractUserDataWrit","_this5","_callSuper","_inherits","convertBytes","bytes","convertReference","convertDocumentKey","forKey","AbstractUserDataWriter","setLogLevel","level","setLogLevel$1","_firestore","_userDataWriter","documentRef","_this6","ref","castReference","result","DocumentSnapshot","DocumentSnapshot$1","_key","_document","metadata","converter","set","data","update","dataOrField","_len","moreFieldsAndValues","Array","_this$_delegate","apply","_len2","_key2","_this$_delegate2","commit","FirestoreDataConverter","fromFirestore","snapshot","expSnapshot","QueryDocumentSnapshot$1","QueryDocumentSnapshot","toFirestore","modelObject","getInstance","converterMapByFirestore","INSTANCES","untypedConverterByConverter","WeakMap","instance","id","parent","path","getModularInstance","DocumentReference$1","refEqual","setDoc","fieldOrUpdateData","_len3","_key3","updateDoc","deleteDoc","onSnapshot","_this7","_len4","args","_key4","extractSnapshotOptions","observer","wrapObserver","_this8","snap","source","getDocFromCache","getDocFromServer","getDoc","withConverter","forPath","canonicalString","_DocumentKey","original","updated","message","replace","_iterator2","_step2","wrapper","userObserver","next","error","complete","val","_a","bind","_b","exists","fieldPath","snapshotEqual","_DocumentSnapshot","_converter","_debugAssert","where","opStr","query","orderBy","directionStr","limit","limitToLast","startAt","startAfter","endBefore","endAt","queryEqual","_this9","getDocsFromCache","getDocsFromServer","getDocs","QuerySnapshot","QuerySnapshot$1","_snapshot","_this10","_len5","_key5","DocumentChange","type","oldIndex","newIndex","size","empty","_this11","docs","map","docChanges","_this12","docChange","forEach","callback","thisArg","_this13","call","_Query","_this14","docRef","documentPath","add","_this15","addDoc","_cast","FieldPath","_len6","fieldNames","_key6","_construct","FieldPath$1","_internalPath","documentId","_FieldPath","keyField","FieldValue","serverTimestamp","delegate","_methodName","deleteField","arrayUnion","arrayRemove","increment","firestoreNamespace","GeoPoint","Timestamp","CACHE_SIZE_UNLIMITED","configureForFirebase","firebase","firestoreFactory","registerComponent","Component","container","app","getProvider","getImmediate","firestoreExp","setServiceProps","registerFirestore","registerVersion","version"],"sources":["../src/util/input_validation.ts","../src/api/blob.ts","../src/api/observer.ts","../src/api/database.ts","../src/api/field_path.ts","../src/api/field_value.ts","../src/config.ts","../src/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirestoreError } from '@firebase/firestore';\nimport { SetOptions } from '@firebase/firestore-types';\n\nexport function validateSetOptions(\n  methodName: string,\n  options: SetOptions | undefined\n): SetOptions {\n  if (options === undefined) {\n    return {\n      merge: false\n    };\n  }\n\n  if (options.mergeFields !== undefined && options.merge !== undefined) {\n    throw new FirestoreError(\n      'invalid-argument',\n      `Invalid options passed to function ${methodName}(): You cannot ` +\n        'specify both \"merge\" and \"mergeFields\".'\n    );\n  }\n\n  return options;\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Bytes, FirestoreError, _isBase64Available } from '@firebase/firestore';\nimport { Compat } from '@firebase/util';\n\n/** Helper function to assert Uint8Array is available at runtime. */\nfunction assertUint8ArrayAvailable(): void {\n  if (typeof Uint8Array === 'undefined') {\n    throw new FirestoreError(\n      'unimplemented',\n      'Uint8Arrays are not available in this environment.'\n    );\n  }\n}\n\n/** Helper function to assert Base64 functions are available at runtime. */\nfunction assertBase64Available(): void {\n  if (!_isBase64Available()) {\n    throw new FirestoreError(\n      'unimplemented',\n      'Blobs are unavailable in Firestore in this environment.'\n    );\n  }\n}\n\n/** Immutable class holding a blob (binary data) */\nexport class Blob implements Compat<Bytes> {\n  constructor(readonly _delegate: Bytes) {}\n  static fromBase64String(base64: string): Blob {\n    assertBase64Available();\n    return new Blob(Bytes.fromBase64String(base64));\n  }\n\n  static fromUint8Array(array: Uint8Array): Blob {\n    assertUint8ArrayAvailable();\n    return new Blob(Bytes.fromUint8Array(array));\n  }\n\n  toBase64(): string {\n    assertBase64Available();\n    return this._delegate.toBase64();\n  }\n\n  toUint8Array(): Uint8Array {\n    assertUint8ArrayAvailable();\n    return this._delegate.toUint8Array();\n  }\n\n  isEqual(other: Blob): boolean {\n    return this._delegate.isEqual(other._delegate);\n  }\n\n  toString(): string {\n    return 'Blob(base64: ' + this.toBase64() + ')';\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirestoreError } from '@firebase/firestore';\n\n/**\n * Observer/Subscribe interfaces.\n */\nexport type NextFn<T> = (value: T) => void;\nexport type ErrorFn = (error: FirestoreError) => void;\nexport type CompleteFn = () => void;\n\n// Allow for any of the Observer methods to be undefined.\nexport interface PartialObserver<T> {\n  next?: NextFn<T>;\n  error?: ErrorFn;\n  complete?: CompleteFn;\n}\n\nexport function isPartialObserver<T>(obj: unknown): obj is PartialObserver<T> {\n  return implementsAnyMethods(obj, ['next', 'error', 'complete']);\n}\n\n/**\n * Returns true if obj is an object and contains at least one of the specified\n * methods.\n */\nfunction implementsAnyMethods(obj: unknown, methods: string[]): boolean {\n  if (typeof obj !== 'object' || obj === null) {\n    return false;\n  }\n\n  const object = obj as Record<string, unknown>;\n  for (const method of methods) {\n    if (method in object && typeof object[method] === 'function') {\n      return true;\n    }\n  }\n  return false;\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseApp } from '@firebase/app-types';\nimport { _FirebaseApp, FirebaseService } from '@firebase/app-types/private';\nimport {\n  LoadBundleTask,\n  Bytes,\n  clearIndexedDbPersistence,\n  disableNetwork,\n  enableIndexedDbPersistence,\n  enableMultiTabIndexedDbPersistence,\n  enableNetwork,\n  ensureFirestoreConfigured,\n  Firestore as ExpFirestore,\n  connectFirestoreEmulator,\n  waitForPendingWrites,\n  FieldPath as ExpFieldPath,\n  limit,\n  limitToLast,\n  where,\n  orderBy,\n  startAfter,\n  startAt,\n  query,\n  endBefore,\n  endAt,\n  doc,\n  collection,\n  collectionGroup,\n  queryEqual,\n  Query as ExpQuery,\n  CollectionReference as ExpCollectionReference,\n  DocumentReference as ExpDocumentReference,\n  refEqual,\n  addDoc,\n  deleteDoc,\n  executeWrite,\n  getDoc,\n  getDocFromCache,\n  getDocFromServer,\n  getDocs,\n  getDocsFromCache,\n  getDocsFromServer,\n  onSnapshot,\n  onSnapshotsInSync,\n  setDoc,\n  updateDoc,\n  Unsubscribe,\n  DocumentChange as ExpDocumentChange,\n  DocumentSnapshot as ExpDocumentSnapshot,\n  QueryDocumentSnapshot as ExpQueryDocumentSnapshot,\n  QuerySnapshot as ExpQuerySnapshot,\n  snapshotEqual,\n  SnapshotMetadata,\n  runTransaction,\n  Transaction as ExpTransaction,\n  WriteBatch as ExpWriteBatch,\n  AbstractUserDataWriter,\n  FirestoreError,\n  FirestoreDataConverter as ModularFirestoreDataConverter,\n  setLogLevel as setClientLogLevel,\n  _DatabaseId,\n  _validateIsNotUsedTogether,\n  _cast,\n  _DocumentKey,\n  _debugAssert,\n  _FieldPath,\n  _ResourcePath,\n  _ByteString,\n  _logWarn,\n  namedQuery,\n  loadBundle,\n  PartialWithFieldValue,\n  WithFieldValue\n} from '@firebase/firestore';\nimport {\n  CollectionReference as PublicCollectionReference,\n  DocumentChange as PublicDocumentChange,\n  DocumentChangeType as PublicDocumentChangeType,\n  DocumentData,\n  DocumentData as PublicDocumentData,\n  DocumentReference as PublicDocumentReference,\n  DocumentSnapshot as PublicDocumentSnapshot,\n  FieldPath as PublicFieldPath,\n  FirebaseFirestore as PublicFirestore,\n  FirestoreDataConverter as PublicFirestoreDataConverter,\n  GetOptions as PublicGetOptions,\n  LogLevel as PublicLogLevel,\n  OrderByDirection as PublicOrderByDirection,\n  PersistenceSettings as PublicPersistenceSettings,\n  Query as PublicQuery,\n  QueryDocumentSnapshot as PublicQueryDocumentSnapshot,\n  QuerySnapshot as PublicQuerySnapshot,\n  SetOptions as PublicSetOptions,\n  Settings as PublicSettings,\n  SnapshotListenOptions as PublicSnapshotListenOptions,\n  SnapshotOptions as PublicSnapshotOptions,\n  Transaction as PublicTransaction,\n  UpdateData as PublicUpdateData,\n  WhereFilterOp as PublicWhereFilterOp,\n  WriteBatch as PublicWriteBatch\n} from '@firebase/firestore-types';\nimport {\n  Compat,\n  EmulatorMockTokenOptions,\n  getModularInstance\n} from '@firebase/util';\n\nimport { validateSetOptions } from '../util/input_validation';\n\nimport { Blob } from './blob';\nimport {\n  CompleteFn,\n  ErrorFn,\n  isPartialObserver,\n  NextFn,\n  PartialObserver\n} from './observer';\n\n/**\n * A persistence provider for either memory-only or IndexedDB persistence.\n * Mainly used to allow optional inclusion of IndexedDB code.\n */\nexport interface PersistenceProvider {\n  enableIndexedDbPersistence(\n    firestore: Firestore,\n    forceOwnership: boolean\n  ): Promise<void>;\n  enableMultiTabIndexedDbPersistence(firestore: Firestore): Promise<void>;\n  clearIndexedDbPersistence(firestore: Firestore): Promise<void>;\n}\n\n/**\n * The persistence provider included with the full Firestore SDK.\n */\nexport class IndexedDbPersistenceProvider implements PersistenceProvider {\n  enableIndexedDbPersistence(\n    firestore: Firestore,\n    forceOwnership: boolean\n  ): Promise<void> {\n    return enableIndexedDbPersistence(firestore._delegate, { forceOwnership });\n  }\n  enableMultiTabIndexedDbPersistence(firestore: Firestore): Promise<void> {\n    return enableMultiTabIndexedDbPersistence(firestore._delegate);\n  }\n  clearIndexedDbPersistence(firestore: Firestore): Promise<void> {\n    return clearIndexedDbPersistence(firestore._delegate);\n  }\n}\n\n/**\n * Compat class for Firestore. Exposes Firestore Legacy API, but delegates\n * to the functional API of firestore-exp.\n */\nexport class Firestore\n  implements PublicFirestore, FirebaseService, Compat<ExpFirestore>\n{\n  _appCompat?: FirebaseApp;\n  constructor(\n    databaseIdOrApp: _DatabaseId | FirebaseApp,\n    readonly _delegate: ExpFirestore,\n    private _persistenceProvider: PersistenceProvider\n  ) {\n    if (!(databaseIdOrApp instanceof _DatabaseId)) {\n      this._appCompat = databaseIdOrApp as FirebaseApp;\n    }\n  }\n\n  get _databaseId(): _DatabaseId {\n    return this._delegate._databaseId;\n  }\n\n  settings(settingsLiteral: PublicSettings): void {\n    const currentSettings = this._delegate._getSettings();\n    if (\n      !settingsLiteral.merge &&\n      currentSettings.host !== settingsLiteral.host\n    ) {\n      _logWarn(\n        'You are overriding the original host. If you did not intend ' +\n          'to override your settings, use {merge: true}.'\n      );\n    }\n\n    if (settingsLiteral.merge) {\n      settingsLiteral = {\n        ...currentSettings,\n        ...settingsLiteral\n      };\n      // Remove the property from the settings once the merge is completed\n      delete settingsLiteral.merge;\n    }\n\n    this._delegate._setSettings(settingsLiteral);\n  }\n\n  useEmulator(\n    host: string,\n    port: number,\n    options: {\n      mockUserToken?: EmulatorMockTokenOptions | string;\n    } = {}\n  ): void {\n    connectFirestoreEmulator(this._delegate, host, port, options);\n  }\n\n  enableNetwork(): Promise<void> {\n    return enableNetwork(this._delegate);\n  }\n\n  disableNetwork(): Promise<void> {\n    return disableNetwork(this._delegate);\n  }\n\n  enablePersistence(settings?: PublicPersistenceSettings): Promise<void> {\n    let synchronizeTabs = false;\n    let experimentalForceOwningTab = false;\n\n    if (settings) {\n      synchronizeTabs = !!settings.synchronizeTabs;\n      experimentalForceOwningTab = !!settings.experimentalForceOwningTab;\n\n      _validateIsNotUsedTogether(\n        'synchronizeTabs',\n        synchronizeTabs,\n        'experimentalForceOwningTab',\n        experimentalForceOwningTab\n      );\n    }\n\n    return synchronizeTabs\n      ? this._persistenceProvider.enableMultiTabIndexedDbPersistence(this)\n      : this._persistenceProvider.enableIndexedDbPersistence(\n          this,\n          experimentalForceOwningTab\n        );\n  }\n\n  clearPersistence(): Promise<void> {\n    return this._persistenceProvider.clearIndexedDbPersistence(this);\n  }\n\n  terminate(): Promise<void> {\n    if (this._appCompat) {\n      (this._appCompat as _FirebaseApp)._removeServiceInstance(\n        'firestore-compat'\n      );\n      (this._appCompat as _FirebaseApp)._removeServiceInstance('firestore');\n    }\n    return this._delegate._delete();\n  }\n\n  waitForPendingWrites(): Promise<void> {\n    return waitForPendingWrites(this._delegate);\n  }\n\n  onSnapshotsInSync(observer: PartialObserver<void>): Unsubscribe;\n  onSnapshotsInSync(onSync: () => void): Unsubscribe;\n  onSnapshotsInSync(arg: unknown): Unsubscribe {\n    return onSnapshotsInSync(this._delegate, arg as PartialObserver<void>);\n  }\n\n  get app(): FirebaseApp {\n    if (!this._appCompat) {\n      throw new FirestoreError(\n        'failed-precondition',\n        \"Firestore was not initialized using the Firebase SDK. 'app' is \" +\n          'not available'\n      );\n    }\n    return this._appCompat as FirebaseApp;\n  }\n\n  INTERNAL = {\n    delete: () => this.terminate()\n  };\n\n  collection(pathString: string): PublicCollectionReference {\n    try {\n      return new CollectionReference(\n        this,\n        collection(this._delegate, pathString)\n      );\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'collection()',\n        'Firestore.collection()'\n      );\n    }\n  }\n\n  doc(pathString: string): PublicDocumentReference {\n    try {\n      return new DocumentReference(this, doc(this._delegate, pathString));\n    } catch (e) {\n      throw replaceFunctionName(e as Error, 'doc()', 'Firestore.doc()');\n    }\n  }\n\n  collectionGroup(collectionId: string): PublicQuery {\n    try {\n      return new Query(this, collectionGroup(this._delegate, collectionId));\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'collectionGroup()',\n        'Firestore.collectionGroup()'\n      );\n    }\n  }\n\n  runTransaction<T>(\n    updateFunction: (transaction: PublicTransaction) => Promise<T>\n  ): Promise<T> {\n    return runTransaction(this._delegate, transaction =>\n      updateFunction(new Transaction(this, transaction))\n    );\n  }\n\n  batch(): PublicWriteBatch {\n    ensureFirestoreConfigured(this._delegate);\n    return new WriteBatch(\n      new ExpWriteBatch(this._delegate, mutations =>\n        executeWrite(this._delegate, mutations)\n      )\n    );\n  }\n\n  loadBundle(\n    bundleData: ArrayBuffer | ReadableStream<Uint8Array> | string\n  ): LoadBundleTask {\n    return loadBundle(this._delegate, bundleData);\n  }\n\n  namedQuery(name: string): Promise<PublicQuery<DocumentData> | null> {\n    return namedQuery(this._delegate, name).then(expQuery => {\n      if (!expQuery) {\n        return null;\n      }\n      return new Query(\n        this,\n        // We can pass `expQuery` here directly since named queries don't have a UserDataConverter.\n        // Otherwise, we would have to create a new ExpQuery and pass the old UserDataConverter.\n        expQuery\n      );\n    });\n  }\n}\n\nexport class UserDataWriter extends AbstractUserDataWriter {\n  constructor(protected firestore: Firestore) {\n    super();\n  }\n\n  protected convertBytes(bytes: _ByteString): Blob {\n    return new Blob(new Bytes(bytes));\n  }\n\n  protected convertReference(name: string): DocumentReference {\n    const key = this.convertDocumentKey(name, this.firestore._databaseId);\n    return DocumentReference.forKey(key, this.firestore, /* converter= */ null);\n  }\n}\n\nexport function setLogLevel(level: PublicLogLevel): void {\n  setClientLogLevel(level);\n}\n\n/**\n * A reference to a transaction.\n */\nexport class Transaction implements PublicTransaction, Compat<ExpTransaction> {\n  private _userDataWriter: UserDataWriter;\n\n  constructor(\n    private readonly _firestore: Firestore,\n    readonly _delegate: ExpTransaction\n  ) {\n    this._userDataWriter = new UserDataWriter(_firestore);\n  }\n\n  get<T>(\n    documentRef: PublicDocumentReference<T>\n  ): Promise<PublicDocumentSnapshot<T>> {\n    const ref = castReference(documentRef);\n    return this._delegate\n      .get(ref)\n      .then(\n        result =>\n          new DocumentSnapshot(\n            this._firestore,\n            new ExpDocumentSnapshot<T>(\n              this._firestore._delegate,\n              this._userDataWriter,\n              result._key,\n              result._document,\n              result.metadata,\n              ref.converter\n            )\n          )\n      );\n  }\n\n  set<T>(\n    documentRef: DocumentReference<T>,\n    data: Partial<T>,\n    options: PublicSetOptions\n  ): Transaction;\n  set<T>(documentRef: DocumentReference<T>, data: T): Transaction;\n  set<T>(\n    documentRef: PublicDocumentReference<T>,\n    data: T | Partial<T>,\n    options?: PublicSetOptions\n  ): Transaction {\n    const ref = castReference(documentRef);\n    if (options) {\n      validateSetOptions('Transaction.set', options);\n      this._delegate.set(ref, data as PartialWithFieldValue<T>, options);\n    } else {\n      this._delegate.set(ref, data as WithFieldValue<T>);\n    }\n    return this;\n  }\n\n  update(\n    documentRef: PublicDocumentReference<unknown>,\n    data: PublicUpdateData\n  ): Transaction;\n  update(\n    documentRef: PublicDocumentReference<unknown>,\n    field: string | PublicFieldPath,\n    value: unknown,\n    ...moreFieldsAndValues: unknown[]\n  ): Transaction;\n  update(\n    documentRef: PublicDocumentReference<unknown>,\n    dataOrField: unknown,\n    value?: unknown,\n    ...moreFieldsAndValues: unknown[]\n  ): Transaction {\n    const ref = castReference(documentRef);\n    if (arguments.length === 2) {\n      this._delegate.update(ref, dataOrField as PublicUpdateData);\n    } else {\n      this._delegate.update(\n        ref,\n        dataOrField as string | ExpFieldPath,\n        value,\n        ...moreFieldsAndValues\n      );\n    }\n\n    return this;\n  }\n\n  delete(documentRef: PublicDocumentReference<unknown>): Transaction {\n    const ref = castReference(documentRef);\n    this._delegate.delete(ref);\n    return this;\n  }\n}\n\nexport class WriteBatch implements PublicWriteBatch, Compat<ExpWriteBatch> {\n  constructor(readonly _delegate: ExpWriteBatch) {}\n  set<T>(\n    documentRef: DocumentReference<T>,\n    data: Partial<T>,\n    options: PublicSetOptions\n  ): WriteBatch;\n  set<T>(documentRef: DocumentReference<T>, data: T): WriteBatch;\n  set<T>(\n    documentRef: PublicDocumentReference<T>,\n    data: T | Partial<T>,\n    options?: PublicSetOptions\n  ): WriteBatch {\n    const ref = castReference(documentRef);\n    if (options) {\n      validateSetOptions('WriteBatch.set', options);\n      this._delegate.set(ref, data as PartialWithFieldValue<T>, options);\n    } else {\n      this._delegate.set(ref, data as WithFieldValue<T>);\n    }\n    return this;\n  }\n\n  update(\n    documentRef: PublicDocumentReference<unknown>,\n    data: PublicUpdateData\n  ): WriteBatch;\n  update(\n    documentRef: PublicDocumentReference<unknown>,\n    field: string | PublicFieldPath,\n    value: unknown,\n    ...moreFieldsAndValues: unknown[]\n  ): WriteBatch;\n  update(\n    documentRef: PublicDocumentReference<unknown>,\n    dataOrField: string | PublicFieldPath | PublicUpdateData,\n    value?: unknown,\n    ...moreFieldsAndValues: unknown[]\n  ): WriteBatch {\n    const ref = castReference(documentRef);\n    if (arguments.length === 2) {\n      this._delegate.update(ref, dataOrField as PublicUpdateData);\n    } else {\n      this._delegate.update(\n        ref,\n        dataOrField as string | ExpFieldPath,\n        value,\n        ...moreFieldsAndValues\n      );\n    }\n    return this;\n  }\n\n  delete(documentRef: PublicDocumentReference<unknown>): WriteBatch {\n    const ref = castReference(documentRef);\n    this._delegate.delete(ref);\n    return this;\n  }\n\n  commit(): Promise<void> {\n    return this._delegate.commit();\n  }\n}\n\n/**\n * Wraps a `PublicFirestoreDataConverter` translating the types from the\n * experimental SDK into corresponding types from the Classic SDK before passing\n * them to the wrapped converter.\n */\nclass FirestoreDataConverter<U>\n  implements\n    ModularFirestoreDataConverter<U>,\n    Compat<PublicFirestoreDataConverter<U>>\n{\n  private static readonly INSTANCES = new WeakMap();\n\n  private constructor(\n    private readonly _firestore: Firestore,\n    private readonly _userDataWriter: UserDataWriter,\n    readonly _delegate: PublicFirestoreDataConverter<U>\n  ) {}\n\n  fromFirestore(\n    snapshot: ExpQueryDocumentSnapshot,\n    options?: PublicSnapshotOptions\n  ): U {\n    const expSnapshot = new ExpQueryDocumentSnapshot(\n      this._firestore._delegate,\n      this._userDataWriter,\n      snapshot._key,\n      snapshot._document,\n      snapshot.metadata,\n      /* converter= */ null\n    );\n    return this._delegate.fromFirestore(\n      new QueryDocumentSnapshot(this._firestore, expSnapshot),\n      options ?? {}\n    );\n  }\n\n  toFirestore(modelObject: WithFieldValue<U>): PublicDocumentData;\n  toFirestore(\n    modelObject: PartialWithFieldValue<U>,\n    options: PublicSetOptions\n  ): PublicDocumentData;\n  toFirestore(\n    modelObject: WithFieldValue<U> | PartialWithFieldValue<U>,\n    options?: PublicSetOptions\n  ): PublicDocumentData {\n    if (!options) {\n      return this._delegate.toFirestore(modelObject as U);\n    } else {\n      return this._delegate.toFirestore(modelObject as Partial<U>, options);\n    }\n  }\n\n  // Use the same instance of `FirestoreDataConverter` for the given instances\n  // of `Firestore` and `PublicFirestoreDataConverter` so that isEqual() will\n  // compare equal for two objects created with the same converter instance.\n  static getInstance<U>(\n    firestore: Firestore,\n    converter: PublicFirestoreDataConverter<U>\n  ): FirestoreDataConverter<U> {\n    const converterMapByFirestore = FirestoreDataConverter.INSTANCES;\n    let untypedConverterByConverter = converterMapByFirestore.get(firestore);\n    if (!untypedConverterByConverter) {\n      untypedConverterByConverter = new WeakMap();\n      converterMapByFirestore.set(firestore, untypedConverterByConverter);\n    }\n\n    let instance = untypedConverterByConverter.get(converter);\n    if (!instance) {\n      instance = new FirestoreDataConverter(\n        firestore,\n        new UserDataWriter(firestore),\n        converter\n      );\n      untypedConverterByConverter.set(converter, instance);\n    }\n\n    return instance;\n  }\n}\n\n/**\n * A reference to a particular document in a collection in the database.\n */\nexport class DocumentReference<T = PublicDocumentData>\n  implements PublicDocumentReference<T>, Compat<ExpDocumentReference<T>>\n{\n  private _userDataWriter: UserDataWriter;\n\n  constructor(\n    readonly firestore: Firestore,\n    readonly _delegate: ExpDocumentReference<T>\n  ) {\n    this._userDataWriter = new UserDataWriter(firestore);\n  }\n\n  static forPath<U>(\n    path: _ResourcePath,\n    firestore: Firestore,\n    converter: ModularFirestoreDataConverter<U> | null\n  ): DocumentReference<U> {\n    if (path.length % 2 !== 0) {\n      throw new FirestoreError(\n        'invalid-argument',\n        'Invalid document reference. Document ' +\n          'references must have an even number of segments, but ' +\n          `${path.canonicalString()} has ${path.length}`\n      );\n    }\n    return new DocumentReference(\n      firestore,\n      new ExpDocumentReference(\n        firestore._delegate,\n        converter,\n        new _DocumentKey(path)\n      )\n    );\n  }\n\n  static forKey<U>(\n    key: _DocumentKey,\n    firestore: Firestore,\n    converter: ModularFirestoreDataConverter<U> | null\n  ): DocumentReference<U> {\n    return new DocumentReference(\n      firestore,\n      new ExpDocumentReference(firestore._delegate, converter, key)\n    );\n  }\n\n  get id(): string {\n    return this._delegate.id;\n  }\n\n  get parent(): PublicCollectionReference<T> {\n    return new CollectionReference(this.firestore, this._delegate.parent);\n  }\n\n  get path(): string {\n    return this._delegate.path;\n  }\n\n  collection(\n    pathString: string\n  ): PublicCollectionReference<PublicDocumentData> {\n    try {\n      return new CollectionReference(\n        this.firestore,\n        collection(this._delegate, pathString)\n      );\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'collection()',\n        'DocumentReference.collection()'\n      );\n    }\n  }\n\n  isEqual(other: PublicDocumentReference<T>): boolean {\n    other = getModularInstance<PublicDocumentReference<T>>(other);\n\n    if (!(other instanceof ExpDocumentReference)) {\n      return false;\n    }\n    return refEqual(this._delegate, other);\n  }\n\n  set(value: Partial<T>, options: PublicSetOptions): Promise<void>;\n  set(value: T): Promise<void>;\n  set(value: T | Partial<T>, options?: PublicSetOptions): Promise<void> {\n    options = validateSetOptions('DocumentReference.set', options);\n    try {\n      if (options) {\n        return setDoc(\n          this._delegate,\n          value as PartialWithFieldValue<T>,\n          options\n        );\n      } else {\n        return setDoc(this._delegate, value as WithFieldValue<T>);\n      }\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'setDoc()',\n        'DocumentReference.set()'\n      );\n    }\n  }\n\n  update(value: PublicUpdateData): Promise<void>;\n  update(\n    field: string | PublicFieldPath,\n    value: unknown,\n    ...moreFieldsAndValues: unknown[]\n  ): Promise<void>;\n  update(\n    fieldOrUpdateData: string | PublicFieldPath | PublicUpdateData,\n    value?: unknown,\n    ...moreFieldsAndValues: unknown[]\n  ): Promise<void> {\n    try {\n      if (arguments.length === 1) {\n        return updateDoc(this._delegate, fieldOrUpdateData as PublicUpdateData);\n      } else {\n        return updateDoc(\n          this._delegate,\n          fieldOrUpdateData as string | ExpFieldPath,\n          value,\n          ...moreFieldsAndValues\n        );\n      }\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'updateDoc()',\n        'DocumentReference.update()'\n      );\n    }\n  }\n\n  delete(): Promise<void> {\n    return deleteDoc(this._delegate);\n  }\n\n  onSnapshot(observer: PartialObserver<PublicDocumentSnapshot<T>>): Unsubscribe;\n  onSnapshot(\n    options: PublicSnapshotListenOptions,\n    observer: PartialObserver<PublicDocumentSnapshot<T>>\n  ): Unsubscribe;\n  onSnapshot(\n    onNext: NextFn<PublicDocumentSnapshot<T>>,\n    onError?: ErrorFn,\n    onCompletion?: CompleteFn\n  ): Unsubscribe;\n  onSnapshot(\n    options: PublicSnapshotListenOptions,\n    onNext: NextFn<PublicDocumentSnapshot<T>>,\n    onError?: ErrorFn,\n    onCompletion?: CompleteFn\n  ): Unsubscribe;\n\n  onSnapshot(...args: unknown[]): Unsubscribe {\n    const options = extractSnapshotOptions(args);\n    const observer = wrapObserver<DocumentSnapshot<T>, ExpDocumentSnapshot<T>>(\n      args,\n      result =>\n        new DocumentSnapshot(\n          this.firestore,\n          new ExpDocumentSnapshot(\n            this.firestore._delegate,\n            this._userDataWriter,\n            result._key,\n            result._document,\n            result.metadata,\n            this._delegate.converter\n          )\n        )\n    );\n    return onSnapshot(this._delegate, options, observer);\n  }\n\n  get(options?: PublicGetOptions): Promise<PublicDocumentSnapshot<T>> {\n    let snap: Promise<ExpDocumentSnapshot<T>>;\n    if (options?.source === 'cache') {\n      snap = getDocFromCache(this._delegate);\n    } else if (options?.source === 'server') {\n      snap = getDocFromServer(this._delegate);\n    } else {\n      snap = getDoc(this._delegate);\n    }\n\n    return snap.then(\n      result =>\n        new DocumentSnapshot(\n          this.firestore,\n          new ExpDocumentSnapshot(\n            this.firestore._delegate,\n            this._userDataWriter,\n            result._key,\n            result._document,\n            result.metadata,\n            this._delegate.converter\n          )\n        )\n    );\n  }\n\n  withConverter(converter: null): PublicDocumentReference<PublicDocumentData>;\n  withConverter<U>(\n    converter: PublicFirestoreDataConverter<U>\n  ): PublicDocumentReference<U>;\n  withConverter<U>(\n    converter: PublicFirestoreDataConverter<U> | null\n  ): PublicDocumentReference<U> {\n    return new DocumentReference<U>(\n      this.firestore,\n      converter\n        ? this._delegate.withConverter(\n            FirestoreDataConverter.getInstance(this.firestore, converter)\n          )\n        : (this._delegate.withConverter(null) as ExpDocumentReference<U>)\n    );\n  }\n}\n\n/**\n * Replaces the function name in an error thrown by the firestore-exp API\n * with the function names used in the classic API.\n */\nfunction replaceFunctionName(\n  e: Error,\n  original: string | RegExp,\n  updated: string\n): Error {\n  e.message = e.message.replace(original, updated);\n  return e;\n}\n\n/**\n * Iterates the list of arguments from an `onSnapshot` call and returns the\n * first argument that may be an `SnapshotListenOptions` object. Returns an\n * empty object if none is found.\n */\nexport function extractSnapshotOptions(\n  args: unknown[]\n): PublicSnapshotListenOptions {\n  for (const arg of args) {\n    if (typeof arg === 'object' && !isPartialObserver(arg)) {\n      return arg as PublicSnapshotListenOptions;\n    }\n  }\n  return {};\n}\n\n/**\n * Creates an observer that can be passed to the firestore-exp SDK. The\n * observer converts all observed values into the format expected by the classic\n * SDK.\n *\n * @param args - The list of arguments from an `onSnapshot` call.\n * @param wrapper - The function that converts the firestore-exp type into the\n * type used by this shim.\n */\nexport function wrapObserver<CompatType, ExpType>(\n  args: unknown[],\n  wrapper: (val: ExpType) => CompatType\n): PartialObserver<ExpType> {\n  let userObserver: PartialObserver<CompatType>;\n  if (isPartialObserver(args[0])) {\n    userObserver = args[0] as PartialObserver<CompatType>;\n  } else if (isPartialObserver(args[1])) {\n    userObserver = args[1];\n  } else if (typeof args[0] === 'function') {\n    userObserver = {\n      next: args[0] as NextFn<CompatType> | undefined,\n      error: args[1] as ErrorFn | undefined,\n      complete: args[2] as CompleteFn | undefined\n    };\n  } else {\n    userObserver = {\n      next: args[1] as NextFn<CompatType> | undefined,\n      error: args[2] as ErrorFn | undefined,\n      complete: args[3] as CompleteFn | undefined\n    };\n  }\n\n  return {\n    next: val => {\n      if (userObserver!.next) {\n        userObserver!.next(wrapper(val));\n      }\n    },\n    error: userObserver.error?.bind(userObserver),\n    complete: userObserver.complete?.bind(userObserver)\n  };\n}\n\n/**\n * Options interface that can be provided to configure the deserialization of\n * DocumentSnapshots.\n */\nexport interface SnapshotOptions extends PublicSnapshotOptions {}\n\nexport class DocumentSnapshot<T = PublicDocumentData>\n  implements PublicDocumentSnapshot<T>, Compat<ExpDocumentSnapshot<T>>\n{\n  constructor(\n    private readonly _firestore: Firestore,\n    readonly _delegate: ExpDocumentSnapshot<T>\n  ) {}\n\n  get ref(): DocumentReference<T> {\n    return new DocumentReference<T>(this._firestore, this._delegate.ref);\n  }\n\n  get id(): string {\n    return this._delegate.id;\n  }\n\n  get metadata(): SnapshotMetadata {\n    return this._delegate.metadata;\n  }\n\n  get exists(): boolean {\n    return this._delegate.exists();\n  }\n\n  data(options?: PublicSnapshotOptions): T | undefined {\n    return this._delegate.data(options);\n  }\n\n  get(\n    fieldPath: string | PublicFieldPath,\n    options?: PublicSnapshotOptions\n    // We are using `any` here to avoid an explicit cast by our users.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any {\n    return this._delegate.get(fieldPath as string | ExpFieldPath, options);\n  }\n\n  isEqual(other: DocumentSnapshot<T>): boolean {\n    return snapshotEqual(this._delegate, other._delegate);\n  }\n}\n\nexport class QueryDocumentSnapshot<T = PublicDocumentData>\n  extends DocumentSnapshot<T>\n  implements PublicQueryDocumentSnapshot<T>\n{\n  data(options?: PublicSnapshotOptions): T {\n    const data = this._delegate.data(options);\n    if (this._delegate._converter) {\n      // Undefined is a possible valid value from converter.\n      return data as T;\n    } else {\n      _debugAssert(\n        data !== undefined,\n        'Document in a QueryDocumentSnapshot should exist'\n      );\n      return data;\n    }\n  }\n}\n\nexport class Query<T = PublicDocumentData>\n  implements PublicQuery<T>, Compat<ExpQuery<T>>\n{\n  private readonly _userDataWriter: UserDataWriter;\n\n  constructor(readonly firestore: Firestore, readonly _delegate: ExpQuery<T>) {\n    this._userDataWriter = new UserDataWriter(firestore);\n  }\n\n  where(\n    fieldPath: string | _FieldPath,\n    opStr: PublicWhereFilterOp,\n    value: unknown\n  ): Query<T> {\n    try {\n      // The \"as string\" cast is a little bit of a hack. `where` accepts the\n      // FieldPath Compat type as input, but is not typed as such in order to\n      // not expose this via our public typings file.\n      return new Query<T>(\n        this.firestore,\n        query(this._delegate, where(fieldPath as string, opStr, value))\n      );\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        /(orderBy|where)\\(\\)/,\n        'Query.$1()'\n      );\n    }\n  }\n\n  orderBy(\n    fieldPath: string | _FieldPath,\n    directionStr?: PublicOrderByDirection\n  ): Query<T> {\n    try {\n      // The \"as string\" cast is a little bit of a hack. `orderBy` accepts the\n      // FieldPath Compat type as input, but is not typed as such in order to\n      // not expose this via our public typings file.\n      return new Query<T>(\n        this.firestore,\n        query(this._delegate, orderBy(fieldPath as string, directionStr))\n      );\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        /(orderBy|where)\\(\\)/,\n        'Query.$1()'\n      );\n    }\n  }\n\n  limit(n: number): Query<T> {\n    try {\n      return new Query<T>(this.firestore, query(this._delegate, limit(n)));\n    } catch (e) {\n      throw replaceFunctionName(e as Error, 'limit()', 'Query.limit()');\n    }\n  }\n\n  limitToLast(n: number): Query<T> {\n    try {\n      return new Query<T>(\n        this.firestore,\n        query(this._delegate, limitToLast(n))\n      );\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'limitToLast()',\n        'Query.limitToLast()'\n      );\n    }\n  }\n\n  startAt(...args: any[]): Query<T> {\n    try {\n      return new Query(this.firestore, query(this._delegate, startAt(...args)));\n    } catch (e) {\n      throw replaceFunctionName(e as Error, 'startAt()', 'Query.startAt()');\n    }\n  }\n\n  startAfter(...args: any[]): Query<T> {\n    try {\n      return new Query(\n        this.firestore,\n        query(this._delegate, startAfter(...args))\n      );\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'startAfter()',\n        'Query.startAfter()'\n      );\n    }\n  }\n\n  endBefore(...args: any[]): Query<T> {\n    try {\n      return new Query(\n        this.firestore,\n        query(this._delegate, endBefore(...args))\n      );\n    } catch (e) {\n      throw replaceFunctionName(e as Error, 'endBefore()', 'Query.endBefore()');\n    }\n  }\n\n  endAt(...args: any[]): Query<T> {\n    try {\n      return new Query(this.firestore, query(this._delegate, endAt(...args)));\n    } catch (e) {\n      throw replaceFunctionName(e as Error, 'endAt()', 'Query.endAt()');\n    }\n  }\n\n  isEqual(other: PublicQuery<T>): boolean {\n    return queryEqual(this._delegate, (other as Query<T>)._delegate);\n  }\n\n  get(options?: PublicGetOptions): Promise<QuerySnapshot<T>> {\n    let query: Promise<ExpQuerySnapshot<T>>;\n    if (options?.source === 'cache') {\n      query = getDocsFromCache(this._delegate);\n    } else if (options?.source === 'server') {\n      query = getDocsFromServer(this._delegate);\n    } else {\n      query = getDocs(this._delegate);\n    }\n    return query.then(\n      result =>\n        new QuerySnapshot(\n          this.firestore,\n          new ExpQuerySnapshot<T>(\n            this.firestore._delegate,\n            this._userDataWriter,\n            this._delegate,\n            result._snapshot\n          )\n        )\n    );\n  }\n\n  onSnapshot(observer: PartialObserver<PublicQuerySnapshot<T>>): Unsubscribe;\n  onSnapshot(\n    options: PublicSnapshotListenOptions,\n    observer: PartialObserver<PublicQuerySnapshot<T>>\n  ): Unsubscribe;\n  onSnapshot(\n    onNext: NextFn<PublicQuerySnapshot<T>>,\n    onError?: ErrorFn,\n    onCompletion?: CompleteFn\n  ): Unsubscribe;\n  onSnapshot(\n    options: PublicSnapshotListenOptions,\n    onNext: NextFn<PublicQuerySnapshot<T>>,\n    onError?: ErrorFn,\n    onCompletion?: CompleteFn\n  ): Unsubscribe;\n\n  onSnapshot(...args: unknown[]): Unsubscribe {\n    const options = extractSnapshotOptions(args);\n    const observer = wrapObserver<QuerySnapshot<T>, ExpQuerySnapshot<T>>(\n      args,\n      snap =>\n        new QuerySnapshot(\n          this.firestore,\n          new ExpQuerySnapshot<T>(\n            this.firestore._delegate,\n            this._userDataWriter,\n            this._delegate,\n            snap._snapshot\n          )\n        )\n    );\n    return onSnapshot(this._delegate, options, observer);\n  }\n\n  withConverter(converter: null): Query<PublicDocumentData>;\n  withConverter<U>(converter: PublicFirestoreDataConverter<U>): Query<U>;\n  withConverter<U>(\n    converter: PublicFirestoreDataConverter<U> | null\n  ): Query<U> {\n    return new Query<U>(\n      this.firestore,\n      converter\n        ? this._delegate.withConverter(\n            FirestoreDataConverter.getInstance(this.firestore, converter)\n          )\n        : (this._delegate.withConverter(null) as ExpQuery<U>)\n    );\n  }\n}\n\nexport class DocumentChange<T = PublicDocumentData>\n  implements PublicDocumentChange<T>, Compat<ExpDocumentChange<T>>\n{\n  constructor(\n    private readonly _firestore: Firestore,\n    readonly _delegate: ExpDocumentChange<T>\n  ) {}\n\n  get type(): PublicDocumentChangeType {\n    return this._delegate.type;\n  }\n\n  get doc(): QueryDocumentSnapshot<T> {\n    return new QueryDocumentSnapshot<T>(this._firestore, this._delegate.doc);\n  }\n\n  get oldIndex(): number {\n    return this._delegate.oldIndex;\n  }\n\n  get newIndex(): number {\n    return this._delegate.newIndex;\n  }\n}\n\nexport class QuerySnapshot<T = PublicDocumentData>\n  implements PublicQuerySnapshot<T>, Compat<ExpQuerySnapshot<T>>\n{\n  constructor(\n    readonly _firestore: Firestore,\n    readonly _delegate: ExpQuerySnapshot<T>\n  ) {}\n\n  get query(): Query<T> {\n    return new Query(this._firestore, this._delegate.query);\n  }\n\n  get metadata(): SnapshotMetadata {\n    return this._delegate.metadata;\n  }\n\n  get size(): number {\n    return this._delegate.size;\n  }\n\n  get empty(): boolean {\n    return this._delegate.empty;\n  }\n\n  get docs(): Array<QueryDocumentSnapshot<T>> {\n    return this._delegate.docs.map(\n      doc => new QueryDocumentSnapshot<T>(this._firestore, doc)\n    );\n  }\n\n  docChanges(\n    options?: PublicSnapshotListenOptions\n  ): Array<PublicDocumentChange<T>> {\n    return this._delegate\n      .docChanges(options)\n      .map(docChange => new DocumentChange<T>(this._firestore, docChange));\n  }\n\n  forEach(\n    callback: (result: QueryDocumentSnapshot<T>) => void,\n    thisArg?: unknown\n  ): void {\n    this._delegate.forEach(snapshot => {\n      callback.call(\n        thisArg,\n        new QueryDocumentSnapshot(this._firestore, snapshot)\n      );\n    });\n  }\n\n  isEqual(other: QuerySnapshot<T>): boolean {\n    return snapshotEqual(this._delegate, other._delegate);\n  }\n}\n\nexport class CollectionReference<T = PublicDocumentData>\n  extends Query<T>\n  implements PublicCollectionReference<T>\n{\n  constructor(\n    readonly firestore: Firestore,\n    readonly _delegate: ExpCollectionReference<T>\n  ) {\n    super(firestore, _delegate);\n  }\n\n  get id(): string {\n    return this._delegate.id;\n  }\n\n  get path(): string {\n    return this._delegate.path;\n  }\n\n  get parent(): DocumentReference<PublicDocumentData> | null {\n    const docRef = this._delegate.parent;\n    return docRef ? new DocumentReference(this.firestore, docRef) : null;\n  }\n\n  doc(documentPath?: string): DocumentReference<T> {\n    try {\n      if (documentPath === undefined) {\n        // Call `doc` without `documentPath` if `documentPath` is `undefined`\n        // as `doc` validates the number of arguments to prevent users from\n        // accidentally passing `undefined`.\n        return new DocumentReference(this.firestore, doc(this._delegate));\n      } else {\n        return new DocumentReference(\n          this.firestore,\n          doc(this._delegate, documentPath)\n        );\n      }\n    } catch (e) {\n      throw replaceFunctionName(\n        e as Error,\n        'doc()',\n        'CollectionReference.doc()'\n      );\n    }\n  }\n\n  add(data: T): Promise<DocumentReference<T>> {\n    return addDoc(this._delegate, data as WithFieldValue<T>).then(\n      docRef => new DocumentReference(this.firestore, docRef)\n    );\n  }\n\n  isEqual(other: CollectionReference<T>): boolean {\n    return refEqual(this._delegate, other._delegate);\n  }\n\n  withConverter(converter: null): CollectionReference<PublicDocumentData>;\n  withConverter<U>(\n    converter: PublicFirestoreDataConverter<U>\n  ): CollectionReference<U>;\n  withConverter<U>(\n    converter: PublicFirestoreDataConverter<U> | null\n  ): CollectionReference<U> {\n    return new CollectionReference<U>(\n      this.firestore,\n      converter\n        ? this._delegate.withConverter(\n            FirestoreDataConverter.getInstance(this.firestore, converter)\n          )\n        : (this._delegate.withConverter(null) as ExpCollectionReference<U>)\n    );\n  }\n}\n\nfunction castReference<T>(\n  documentRef: PublicDocumentReference<T>\n): ExpDocumentReference<T> {\n  return _cast<ExpDocumentReference<T>>(documentRef, ExpDocumentReference);\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FieldPath as ExpFieldPath,\n  _FieldPath as InternalFieldPath\n} from '@firebase/firestore';\nimport { FieldPath as PublicFieldPath } from '@firebase/firestore-types';\nimport { Compat, getModularInstance } from '@firebase/util';\n\n// The objects that are a part of this API are exposed to third-parties as\n// compiled javascript so we want to flag our private members with a leading\n// underscore to discourage their use.\n\n/**\n * A `FieldPath` refers to a field in a document. The path may consist of a\n * single field name (referring to a top-level field in the document), or a list\n * of field names (referring to a nested field in the document).\n */\nexport class FieldPath implements PublicFieldPath, Compat<ExpFieldPath> {\n  readonly _delegate: ExpFieldPath;\n  /**\n   * Creates a FieldPath from the provided field names. If more than one field\n   * name is provided, the path will point to a nested field in a document.\n   *\n   * @param fieldNames - A list of field names.\n   */\n  constructor(...fieldNames: string[]) {\n    this._delegate = new ExpFieldPath(...fieldNames);\n  }\n\n  static documentId(): FieldPath {\n    /**\n     * Internal Note: The backend doesn't technically support querying by\n     * document ID. Instead it queries by the entire document name (full path\n     * included), but in the cases we currently support documentId(), the net\n     * effect is the same.\n     */\n    return new FieldPath(InternalFieldPath.keyField().canonicalString());\n  }\n\n  isEqual(other: PublicFieldPath): boolean {\n    other = getModularInstance(other);\n\n    if (!(other instanceof ExpFieldPath)) {\n      return false;\n    }\n    return this._delegate._internalPath.isEqual(other._internalPath);\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  arrayRemove,\n  arrayUnion,\n  deleteField,\n  FieldValue as FieldValue1,\n  increment,\n  serverTimestamp\n} from '@firebase/firestore';\nimport { FieldValue as PublicFieldValue } from '@firebase/firestore-types';\nimport { Compat } from '@firebase/util';\n\nexport class FieldValue implements PublicFieldValue, Compat<FieldValue1> {\n  static serverTimestamp(): FieldValue {\n    const delegate = serverTimestamp();\n    delegate._methodName = 'FieldValue.serverTimestamp';\n    return new FieldValue(delegate);\n  }\n\n  static delete(): FieldValue {\n    const delegate = deleteField();\n    delegate._methodName = 'FieldValue.delete';\n    return new FieldValue(delegate);\n  }\n\n  static arrayUnion(...elements: unknown[]): FieldValue {\n    const delegate = arrayUnion(...elements);\n    delegate._methodName = 'FieldValue.arrayUnion';\n    return new FieldValue(delegate);\n  }\n\n  static arrayRemove(...elements: unknown[]): FieldValue {\n    const delegate = arrayRemove(...elements);\n    delegate._methodName = 'FieldValue.arrayRemove';\n    return new FieldValue(delegate);\n  }\n\n  static increment(n: number): FieldValue {\n    const delegate = increment(n);\n    delegate._methodName = 'FieldValue.increment';\n    return new FieldValue(delegate);\n  }\n\n  constructor(readonly _delegate: FieldValue1) {}\n\n  isEqual(other: FieldValue): boolean {\n    return this._delegate.isEqual(other._delegate);\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { FirebaseApp } from '@firebase/app-compat';\nimport { FirebaseNamespace } from '@firebase/app-types';\nimport { _FirebaseNamespace } from '@firebase/app-types/private';\nimport { Component, ComponentType } from '@firebase/component';\nimport {\n  Firestore as ModularFirestore,\n  CACHE_SIZE_UNLIMITED,\n  GeoPoint,\n  Timestamp\n} from '@firebase/firestore';\n\nimport { Blob } from './api/blob';\nimport {\n  Firestore,\n  Transaction,\n  CollectionReference,\n  DocumentReference,\n  DocumentSnapshot,\n  Query,\n  QueryDocumentSnapshot,\n  QuerySnapshot,\n  WriteBatch,\n  setLogLevel\n} from './api/database';\nimport { FieldPath } from './api/field_path';\nimport { FieldValue } from './api/field_value';\n\nconst firestoreNamespace = {\n  Firestore,\n  GeoPoint,\n  Timestamp,\n  Blob,\n  Transaction,\n  WriteBatch,\n  DocumentReference,\n  DocumentSnapshot,\n  Query,\n  QueryDocumentSnapshot,\n  QuerySnapshot,\n  CollectionReference,\n  FieldPath,\n  FieldValue,\n  setLogLevel,\n  CACHE_SIZE_UNLIMITED\n};\n\n/**\n * Configures Firestore as part of the Firebase SDK by calling registerComponent.\n *\n * @param firebase - The FirebaseNamespace to register Firestore with\n * @param firestoreFactory - A factory function that returns a new Firestore\n *    instance.\n */\nexport function configureForFirebase(\n  firebase: FirebaseNamespace,\n  firestoreFactory: (\n    app: FirebaseApp,\n    firestoreExp: ModularFirestore\n  ) => Firestore\n): void {\n  (firebase as _FirebaseNamespace).INTERNAL.registerComponent(\n    new Component(\n      'firestore-compat',\n      container => {\n        const app = container.getProvider('app-compat').getImmediate()!;\n        const firestoreExp = container.getProvider('firestore').getImmediate()!;\n        return firestoreFactory(app, firestoreExp);\n      },\n      'PUBLIC' as ComponentType.PUBLIC\n    ).setServiceProps({ ...firestoreNamespace })\n  );\n}\n","/**\n * @license\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport firebase from '@firebase/app-compat';\nimport type { FirebaseNamespace } from '@firebase/app-types';\nimport * as types from '@firebase/firestore-types';\n\nimport { name, version } from '../package.json';\n\nimport { Firestore, IndexedDbPersistenceProvider } from './api/database';\nimport { configureForFirebase } from './config';\n\nimport './register-module';\n\n/**\n * Registers the main Firestore build with the components framework.\n * Persistence can be enabled via `firebase.firestore().enablePersistence()`.\n */\nexport function registerFirestore(instance: FirebaseNamespace): void {\n  configureForFirebase(\n    instance,\n    (app, firestoreExp) =>\n      new Firestore(app, firestoreExp, new IndexedDbPersistenceProvider())\n  );\n  instance.registerVersion(name, version);\n}\n\nregisterFirestore(firebase as unknown as FirebaseNamespace);\n\ndeclare module '@firebase/app-compat' {\n  interface FirebaseNamespace {\n    firestore: {\n      (app?: FirebaseApp): types.FirebaseFirestore;\n      Blob: typeof types.Blob;\n      CollectionReference: typeof types.CollectionReference;\n      DocumentReference: typeof types.DocumentReference;\n      DocumentSnapshot: typeof types.DocumentSnapshot;\n      FieldPath: typeof types.FieldPath;\n      FieldValue: typeof types.FieldValue;\n      Firestore: typeof types.FirebaseFirestore;\n      GeoPoint: typeof types.GeoPoint;\n      Query: typeof types.Query;\n      QueryDocumentSnapshot: typeof types.QueryDocumentSnapshot;\n      QuerySnapshot: typeof types.QuerySnapshot;\n      Timestamp: typeof types.Timestamp;\n      Transaction: typeof types.Transaction;\n      WriteBatch: typeof types.WriteBatch;\n      setLogLevel: typeof types.setLogLevel;\n    };\n  }\n  interface FirebaseApp {\n    firestore?(): types.FirebaseFirestore;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}